{% extends "base.html" %}

{% block content %}
    <h1>Add a New Trade</h1>
    <form method="POST" action="{{ url_for('main.add_trade') }}">
        <fieldset>
            <div class="form-group">
                <label for="ticker" class="form-label mt-4">Symbol</label>
                <select class="form-select" id="ticker" name="ticker" required>
                    {% for sym in symbols %}
                        <option value="{{ sym }}">{{ sym }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="form-group">
                <label for="entry_date" class="form-label mt-4">Entry Date</label>
                <input type="datetime-local" class="form-control" id="entry_date" name="entry_date" required>
            </div>
            <div class="form-group">
                <label for="entry_price" class="form-label mt-4">Entry Price</label>
                <input type="number" step="any" class="form-control" id="entry_price" name="entry_price" required>
            </div>
            <div class="form-group">
                <label for="position_size" class="form-label mt-4">Position Size</label>
                <input type="number" step="any" class="form-control" id="position_size" name="position_size" required>
            </div>
            <div class="form-group">
                <label for="direction" class="form-label mt-4">Direction</label>
                <select class="form-select" id="direction" name="direction">
                    <option>Long</option>
                    <option>Short</option>
                </select>
            </div>
            <div class="form-group">
                <label for="exit_date" class="form-label mt-4">Exit Date</label>
                <input type="datetime-local" class="form-control" id="exit_date" name="exit_date">
            </div>
            <div class="form-group">
                <label for="exit_price" class="form-label mt-4">Exit Price</label>
                <input type="number" step="any" class="form-control" id="exit_price" name="exit_price">
            </div>
            <div class="form-group">
                <label class="form-label mt-4">Strategy</label>
                <div id="strategy-picker" class="d-flex flex-wrap gap-2">
                    {% for strat in strategies %}
                        <div class="form-check">
                            <input type="radio" class="form-check-input" name="strategy_choice" id="strat-{{ loop.index }}" value="{{ strat }}" required>
                            <label class="form-check-label btn btn-outline-info" for="strat-{{ loop.index }}">{{ strat }}</label>
                        </div>
                    {% endfor %}
                    <div class="form-check">
                        <input type="radio" class="form-check-input" name="strategy_choice" id="strat-new" value="__new__" required>
                        <label class="form-check-label btn btn-outline-success" for="strat-new">+ Add New</label>
                    </div>
                </div>
                <input type="text" class="form-control mt-2" id="strategy_new_input" name="strategy_new" placeholder="Enter new strategy name" style="display: none;">
            </div>
            <div class="form-group">
                <label for="notes" class="form-label mt-4">Notes</label>
                <textarea class="form-control" id="notes" name="notes" rows="3"></textarea>
            </div>
            <button type="submit" class="btn btn-primary mt-4">Add Trade</button>
        </fieldset>
    </form>
{% endblock %}

{% block scripts %}
<script>
    // --- Strategy Picker Logic ---
    const strategyPicker = document.getElementById('strategy-picker');
    const newStrategyInput = document.getElementById('strategy_new_input');

    strategyPicker.addEventListener('change', (event) => {
        if (event.target.name === 'strategy_choice') {
            if (event.target.value === '__new__') {
                newStrategyInput.style.display = 'block';
                newStrategyInput.required = true;
                newStrategyInput.focus();
            } else {
                newStrategyInput.style.display = 'none';
                newStrategyInput.required = false;
                newStrategyInput.value = '';
            }
        }
    });

    // Set initial state on page load
    const initialSelection = document.querySelector('input[name="strategy_choice"]:checked');
    if (!initialSelection) {
        newStrategyInput.style.display = 'none';
        newStrategyInput.required = false;
    }
</script>
{% endblock %} 