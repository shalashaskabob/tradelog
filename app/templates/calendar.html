{% extends "base.html" %}
{% block content %}
{% set prev_month = month - 1 if month > 1 else 12 %}
{% set prev_year = year if month > 1 else year - 1 %}
{% set next_month = month + 1 if month < 12 else 1 %}
{% set next_year = year if month < 12 else year + 1 %}
<div class="d-flex justify-content-between align-items-center mt-4">
    <h1>{{ month_name }} {{ year }} PnL Calendar</h1>
    <div>
        <a href="{{ url_for('main.calendar', year=year-1, month=month) }}" class="btn btn-outline-secondary">&laquo; {{ year-1 }}</a>
        <a href="{{ url_for('main.calendar', year=prev_year, month=prev_month) }}" class="btn btn-outline-secondary">&lsaquo; Prev</a>
        <a href="{{ url_for('main.calendar', year=next_year, month=next_month) }}" class="btn btn-outline-secondary">Next &rsaquo;</a>
        <a href="{{ url_for('main.calendar', year=year+1, month=month) }}" class="btn btn-outline-secondary">{{ year+1 }} &raquo;</a>
    </div>
</div>
<div class="card mt-4">
    <div class="card-body">
        <table class="table table-dark table-bordered text-center align-middle mb-0">
            <thead>
                <tr>
                    <th>Sun</th><th>Mon</th><th>Tue</th><th>Wed</th><th>Thu</th><th>Fri</th><th>Sat</th>
                </tr>
            </thead>
            <tbody>
                {% for week in cal_grid %}
                <tr>
                    {% for day in week %}
                        {% if day != 0 %}
                            {% set d = calendar_cells[(year, month, day)] %}
                            {% set day_pnl = daily_pnl.get(d) %}
                            {% set trades = daily_trades.get(d, []) %}
                            {% if day_pnl is not none %}
                                <td class="p-1" style="vertical-align: top; background-color: {% if day_pnl > 0 %}#183c1a{% elif day_pnl < 0 %}#3c1a1a{% else %}#222{% endif %}; color: #fff; min-width: 120px; min-height: 80px;">
                                    <div class="fw-bold">{{ day_pnl|round(2) }}</div>
                                    <div class="small text-muted">{{ day }}</div>
                                    {% if trades|length > 0 %}
                                        <div class="small">{{ trades|length }} trade{{ 's' if trades|length > 1 else '' }}</div>
                                    {% endif %}
                                </td>
                            {% else %}
                                <td class="bg-dark" style="min-width: 120px; min-height: 80px;"></td>
                            {% endif %}
                        {% else %}
                            <td class="bg-transparent" style="min-width: 120px; min-height: 80px;"></td>
                        {% endif %}
                    {% endfor %}
                </tr>
                <tr>
                    <td colspan="7" class="text-end small text-info">
                        {# Week PnL summary can be improved in a future step #}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %} 